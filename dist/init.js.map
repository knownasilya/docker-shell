{"version":3,"sources":["../lib/init.js"],"names":["rawOpts","resolve","reject","options","normalizeOptions","process","env","dockerDomain","create","version","on","e","connectOptions","run","docker","listContainers","then","catch","err"],"mappings":";;;;;;kBAKe,UAAUA,OAAV,EAAmB;AAChC,SAAO,uBAAa,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACvC,UAAMC,UAAU,qBAAWC,gBAAX,CAA4BJ,OAA5B,EAAqCK,QAAQC,GAA7C,CAAhB;AACA,UAAMC,eAAe,iBAAOC,MAAP,EAArB;;AAEAL,YAAQM,OAAR,GAAkB,OAAlB;;AAEAF,iBAAaG,EAAb,CAAgB,OAAhB,EAAyBC,KAAK;AAC5BA,QAAEC,cAAF,GAAmBT,OAAnB;AACAD,aAAOS,CAAP;AACD,KAHD;;AAKAJ,iBAAaM,GAAb,CAAiB,MAAM;AACrB,UAAI;AACF,cAAMC,SAAS,iCAAWX,OAAX,CAAf;;AAEAW,eAAOC,cAAP,GACGC,IADH,CACQ,MAAM;AACVf,kBAAQa,MAAR;AACD,SAHH,EAIGG,KAJH,CAIUC,GAAD,IAAS;AACdA,cAAIN,cAAJ,GAAqBT,OAArB;AACAD,iBAAOgB,GAAP;AACD,SAPH;AAQD,OAXD,CAWE,OAAOP,CAAP,EAAU;AACVA,UAAEC,cAAF,GAAmBT,OAAnB;AACAD,eAAOS,CAAP;AACD;AACF,KAhBD;AAiBD,GA5BM,CAAP;AA6BD,C;;AAnCD;;;;AACA;;;;AACA;;;;AACA;;;;;;AAgCC","file":"init.js","sourcesContent":["import Bluebird from 'bluebird';\nimport Docker from 'dockerode-promise-es6';\nimport domain from 'domain';\nimport dockerUtil from './docker-util';\n\nexport default function (rawOpts) {\n  return new Bluebird((resolve, reject) => {\n    const options = dockerUtil.normalizeOptions(rawOpts, process.env);\n    const dockerDomain = domain.create();\n\n    options.version = 'v1.30';\n\n    dockerDomain.on('error', e => {\n      e.connectOptions = options;\n      reject(e);\n    });\n\n    dockerDomain.run(() => {\n      try {\n        const docker = new Docker(options);\n\n        docker.listContainers()\n          .then(() => {\n            resolve(docker);\n          })\n          .catch((err) => {\n            err.connectOptions = options;\n            reject(err);\n          });\n      } catch (e) {\n        e.connectOptions = options;\n        reject(e);\n      }\n    });\n  });\n};\n"]}